# 📊 Xinchao CRM 데이터 변환 도구 사용 가이드

## 개요

이 도구는 **ADVERTISEMENT DETAILS 시트**(첫 번째 파일)의 데이터를 **고객관리 시트**(두 번째 파일) 형식으로 자동 변환하는 시스템입니다.

## 🎯 주요 기능

### 1. 자동 데이터 변환
- 업체명, 주소, 전화번호 자동 매핑
- 전화번호 문자열을 전화번호/모바일로 자동 분리
- 광고 사이즈 기반 고객 유형 자동 분류
- 호수 범위 자동 파싱 및 Vol 컬럼 자동 채우기
- 계약 금액 및 미수금 자동 계산

### 2. 데이터 내보내기
- CSV 파일 다운로드 (Google Sheets 임포트 가능)
- JSON 파일 다운로드 (디버깅 및 백업용)

### 3. 실시간 미리보기
- 변환된 데이터 테이블 미리보기
- 변환 통계 및 요약 정보 표시

## 📁 생성된 파일 구조

```
xinchao_crm/
├── src/
│   ├── App.js (업데이트됨)
│   ├── components/
│   │   └── DataTransformer.js (신규)
│   └── utils/
│       └── dataTransformer.js (신규)
├── data-mapping-guide.md (신규)
└── README_데이터변환가이드.md (이 파일)
```

## 🚀 사용 방법

### 1단계: 애플리케이션 실행

```bash
cd c:\xinchao_crm
npm start
```

### 2단계: 데이터 변환 도구 탭으로 이동

브라우저에서 `http://localhost:3000` 접속 후:
1. 상단 탭에서 **"🔄 데이터 변환 도구"** 클릭
2. **"🔄 데이터 변환 시작"** 버튼 클릭
3. 변환 완료 메시지 확인

### 3단계: 변환된 데이터 확인

- **미리보기 테이블**: 처음 10개 행 확인
- **변환 통계**: 원본/변환 행 수, 고객 유형별 통계 확인

### 4단계: 데이터 다운로드

- **CSV 다운로드**: Google Sheets 또는 Excel에서 열기
- **JSON 다운로드**: 백업 또는 프로그래밍 용도

### 5단계: Google Sheets 임포트

1. 두 번째 파일(고객관리 시트) 열기
2. `파일` → `가져오기` → `업로드`
3. 다운로드한 CSV 파일 선택
4. 가져오기 옵션:
   - **구분 기호**: 쉼표
   - **위치**: 기존 시트에 바꾸기 또는 새 시트 만들기
   - **문자 인코딩**: UTF-8

## 📋 데이터 매핑 상세

### ✅ 자동 변환되는 항목

| 원본 필드 | 목표 필드 | 변환 로직 |
|----------|----------|-----------|
| CUSTOMER | 업체명 | 그대로 복사 |
| Address | 주소 | 그대로 복사 |
| Tel | 전화번호 + 모바일 | 세미콜론/슬래시로 분리 |
| Size | 광고 사이즈 + 고객 유형 | FC→대형, 1/2→중형, 1/4→소형 |
| Price | 단가 | $ 기호 제거 후 숫자 변환 |
| Received | 누적 미수금 계산에 사용 | Price - Received |
| Have collect | 누적 미수금 | 그대로 복사 |
| Remarks | 최종 상담 기록 + 호수 파싱 | "552~557" → 시작:552, 종료:557 |

### ⚠️ 수동 입력 필요 항목

다음 항목은 원본 데이터에 없어 **변환 후 수동으로 입력**해야 합니다:

- 업종
- 대표자
- 담당자
- 이메일
- 카카오톡
- 온라인 병행 단가
- 온라인 기간
- 온라인 총액
- 시작일 (정확한 날짜)
- 종료일 (정확한 날짜)
- 계산서 발행 여부

## 🔍 데이터 변환 예시

### 입력 (ADVERTISEMENT DETAILS)

| No | CUSTOMER | Address | Tel | Size | Price | Received | Have collect | Remarks |
|----|----------|---------|-----|------|-------|----------|--------------|---------|
| 1 | Awesome Academy | 204B/1 Nguyen Van Huong st. | 093 888 5891 | FC | $450 | $450 | $0 | 552~557 |

### 출력 (고객관리 시트)

| 고객 유형 | 업체명 | 주소 | 전화번호 | 광고 사이즈 | 단가 | 시작 호수 | 종료 호수 | 총 계약 금액 | Vol 552 | Vol 553 | Vol 554 | Vol 555 | Vol 556 | Vol 557 | 누적 미수금 | 최종 상담 기록 |
|---------|--------|------|---------|-----------|------|---------|---------|------------|---------|---------|---------|---------|---------|---------|-----------|-------------|
| 대형광고주 | Awesome Academy | 204B/1 Nguyen Van Huong st. | 093 888 5891 | FC | $450 | 552 | 557 | $2,700 | $450 | $450 | $450 | $450 | $450 | $450 | $0 | 552~557 |

**계산 로직:**
- 총 계약 금액 = $450 × (557 - 552 + 1) = $450 × 6 = $2,700
- Vol 552~557 각 셀에 $450 입력
- 누적 미수금 = $0 (Have collect 값)

## 🛠️ 기술 스펙

### 핵심 함수 (utils/dataTransformer.js)

```javascript
// 전화번호 분리
parsePhoneNumbers(telString)

// 고객 유형 판단
determineCustomerType(size)

// 호수 범위 추출
parseVolumeRange(remarks)

// 가격 파싱
parsePrice(priceString)

// Vol 컬럼 생성
generateVolumeColumns(startVol, endVol, price)

// 총액 계산
calculateTotalAmount(startVol, endVol, pricePerIssue)

// 단일 행 변환
transformAdRow(row)

// 전체 데이터 변환
transformAllAdData(adRows)

// CSV 내보내기
exportToCSV(transformedData)
```

### React 컴포넌트

- **DataTransformer.js**: 메인 변환 UI 컴포넌트
- **App.js**: 탭 네비게이션 및 대시보드 통합

## 📊 변환 통계 예시

변환 완료 후 다음과 같은 통계가 표시됩니다:

```
=== 데이터 변환 완료 ===
원본 행 수: 101
변환된 행 수: 95

고객 유형별 통계:
  대형광고주: 31개
  중형광고주: 42개
  소형광고주: 15개
  옐로우페이지: 7개

미수금 있는 고객: 18개

[수동 입력 필요 항목]
- 업종
- 대표자
- 담당자
- 이메일
- 카카오톡
- 온라인 관련 정보
====================
```

## ❗ 주의사항

### 1. Google Sheets API 제한
- Google Sheets CSV 내보내기 기능 사용
- 시트가 "공개" 또는 "링크가 있는 모든 사용자"로 설정되어 있어야 함

### 2. 데이터 정제
변환 후 다음 항목을 확인하세요:
- ✅ 전화번호 형식 (여러 번호가 올바르게 분리되었는지)
- ✅ 가격 계산 (총 계약 금액이 정확한지)
- ✅ 호수 범위 (시작/종료 호수가 올바르게 파싱되었는지)
- ✅ Vol 컬럼 (계약 범위 내 셀에만 가격이 입력되었는지)

### 3. 특수 케이스

일부 데이터는 특수 처리가 필요합니다:

- **Monthly 계약**: "monthly~Jul'26" 같은 표기는 호수로 변환 불가 → 수동 입력 필요
- **복수 호수 범위**: "543~548+~554" 같은 불연속 범위 → 첫 번째 범위만 자동 처리
- **온라인+지면 병행**: "FC+yell 1/2." 같은 복합 광고 → Size 필드 그대로 유지

## 🔧 문제 해결

### CSV 파일이 한글이 깨져 보일 때
- Excel: `데이터` → `텍스트/CSV에서` → `UTF-8` 선택
- Google Sheets: 자동으로 UTF-8 인식

### 변환이 실패할 때
1. 브라우저 개발자 도구 (F12) → Console 탭 확인
2. Google Sheets가 공개 설정인지 확인
3. 인터넷 연결 상태 확인

### Vol 컬럼이 비어있을 때
- Remarks 필드의 호수 형식 확인 (예: "552~557")
- 호수가 550~574 범위 내에 있는지 확인

## 📞 추가 지원

더 자세한 매핑 규칙은 `data-mapping-guide.md` 파일을 참조하세요.

변환 로직을 커스터마이징하려면 `src/utils/dataTransformer.js` 파일을 수정하세요.

---

**만든이**: AI Assistant  
**날짜**: 2026-02-16  
**버전**: 1.0
