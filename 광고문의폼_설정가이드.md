# 📝 광고 문의 자동화 시스템 - 설정 및 사용 가이드

## 🎯 목표

- **온라인 폼**: 웹사이트 방문자가 직접 입력
- **오프라인 폼**: 담당자가 전화/면담 후 입력
- **자동 저장**: 모든 데이터가 Google Sheets의 "광고접수인덱스"에 자동 저장
- **자동 표시**: 앱의 LeadPipeline에 자동으로 표시됨

---

## 🔧 설치 순서

### **1단계: Google Apps Script 배포하기**

#### 1️⃣ Google Sheets 열기

```
https://docs.google.com/spreadsheets/d/1gbtZ7jTsYvN7IQ8gnpMNg2TVJHu-lo9o3UWIvJ7fsPo/edit
```

- 기존의 "광고접수인덱스" 시트가 있는 스프레드시트를 엽니다

#### 2️⃣ Apps Script 편집기 열기

메뉴: **확장 프로그램 > Apps Script**

![Step 1](https://user-images.githubusercontent.com/example/1.png)

#### 3️⃣ 코드 복사하기

파일: `GoogleAppsScript_광고문의자동등록.gs` 에서 전체 코드를 복사

#### 4️⃣ 붙여넣기

Apps Script 편집기의 기본 코드를 지우고 붙여넣기

```javascript
/**
 * Google Apps Script - 광고 문의 자동 접수 시스템
 */
// 아래 코드가 여기에 붙여넣어집니다
```

#### 5️⃣ SHEET_ID 수정하기

코드 상단에서:

```javascript
const SHEET_ID = "1gbtZ7jTsYvN7IQ8gnpMNg2TVJHu-lo9o3UWIvJ7fsPo"; // ← 이 부분 수정
```

수정 방법:

- Google Sheets URL: `https://docs.google.com/spreadsheets/d/**1DHDAsd059_idII31hFhS1nR6bjjxw0ocDai3sqRag_M**/edit`
- 볼드 부분(ID)을 복사해서 따옴표 안에 붙여넣기

**예시:**

```javascript
const SHEET_ID = "1gbtZ7jTsYvN7IQ8gnpMNg2TVJHu-lo9o3UWIvJ7fsPo";
```

#### 6️⃣ 저장

**Ctrl + S** 또는 **저장** 버튼 클릭

#### 7️⃣ 배포하기

메뉴: **배포 > 새 배포**

![배포1](https://user-images.githubusercontent.com/example/deploy1.png)

설정:

- **유형**: 웹 앱
- **실행 사용자**: 나 (본인 Google 계정)
- **액세스 권한**: 모든 사용자

![배포2](https://user-images.githubusercontent.com/example/deploy2.png)

#### 8️⃣ URL 복사

배포 후 나타나는 웹 앱 URL을 복사합니다:

```
https://script.google.com/macros/d/[스크립트ID]/usercodeapp
```

**예시:**

```
https://script.google.com/macros/d/1ABCDEFGHIJKLMNOPQRSTUVWXYZxyz123/usercodeapp
```

---

### **2단계: HTML 폼 업데이트하기**

#### 온라인 폼 수정

파일: `광고문의폼_온라인.html`

```javascript
// 29번 줄 근처
const GOOGLE_APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw1rd5SbMDMSxDYbCarcuJ5chVgcKKQgEvyJfXR0xEpYxs-tP93ZJigYoB6XgDzfoOpGQ/exec";

                                                                    ↑
                                                    1단계에서 복사한 URL
```

수정 후:

```javascript
const GOOGLE_APPS_SCRIPT_URL =
  "https://script.google.com/macros/s/AKfycbw1rd5SbMDMSxDYbCarcuJ5chVgcKKQgEvyJfXR0xEpYxs-tP93ZJigYoB6XgDzfoOpGQ/exec";
```

#### 오프라인 폼 수정

파일: `광고문의폼_오프라인.html`

동일하게 21번 줄의 URL을 업데이트합니다

---

### **3단계: 폼 배포하기**

#### 온라인 폼 (외부 웹사이트에 심기)

**방법 1: HTML 파일 직접 사용**

```html
<!-- 웹사이트의 <head> 태그에 추가 -->
<iframe
  src="file:///path/to/광고문의폼_온라인.html"
  width="100%"
  height="800"
  style="border:none;"
></iframe>
```

**방법 2: 웹 서버에 호스팅**

1. `광고문의폼_온라인.html` 파일을 웹 서버에 업로드
2. 웹사이트에서 iframe으로 임베드:

```html
<iframe
  src="https://yoursite.com/inquiry-form.html"
  width="100%"
  height="800"
  style="border:none;"
></iframe>
```

#### 오프라인 폼 (담당자용)

**방법 1: 로컬 파일로 열기**

1. `광고문의폼_오프라인.html` 파일을 더블클릭
2. 브라우저에서 열림

**방법 2: 회사 서버에 호스팅**

```
https://yoursite.com/inquiry-offline.html
```

담당자에게 이 URL을 공유하면 언제든 입력 가능

---

## 📋 폼 필드 설명

### **온라인 폼**

| 필드     | 필수 | 설명             |
| -------- | ---- | ---------------- |
| 회사명   | ✅   | 광고주 회사명    |
| 담당자명 | ✅   | 담당자 이름      |
| 직책     | ❌   | 담당자 직책      |
| 전화     | ✅   | 회사 전화번호    |
| 이메일   | ❌   | 담당자 이메일    |
| 광고유형 | ❌   | 전면/반면/사분면 |
| 광고크기 | ❌   | FC/1/2 Page 등   |
| 시작시기 | ❌   | 광고 시작 예정일 |
| 문의내용 | ❌   | 상세 요청사항    |

### **오프라인 폼** (온라인 + 추가)

| 필드               | 필수 | 설명                    |
| ------------------ | ---- | ----------------------- |
| 접수경로           | ✅   | 전화/면담/이메일/기타   |
| **담당자(입력자)** | ✅   | 이 문의를 입력한 담당자 |

---

## 🚀 사용 방법

### **시나리오 1: 온라인 폼 (웹사이트)**

```
1. 고객이 웹사이트 방문
   ↓
2. "광고 문의" 폼 작성
   ↓
3. "문의 제출" 클릭
   ↓
4. Google Sheets에 자동 저장
   ↓
5. 앱의 LeadPipeline에 자동 표시
   ↓
6. "문의 수렴" 단계로 자동 할당
```

### **시나리오 2: 오프라인 폼 (담당자 입력)**

```
1. 담당자가 전화/면담으로 문의 받음
   ↓
2. 오프라인 폼 URL 열기
   ↓
3. 고객 정보 입력
   ↓
4. "담당자(입력자)" = 자신의 이름 입력
   ↓
5. "문의 등록" 클릭
   ↓
6. Google Sheets에 자동 저장
   ↓
7. 앱의 LeadPipeline에 자동 표시
   ↓
8. "문의 수렴" 단계로 할당
```

---

## ✅ 테스트하기

### **방법 1: 폼으로 테스트**

1. 온라인 폼 또는 오프라인 폼 열기
2. 테스트 데이터 입력
3. "제출" 또는 "등록" 클릭
4. ✅ 성공 메시지 나타남
5. Google Sheets 확인 → 새 행이 추가되어 있음

### **방법 2: Apps Script로 테스트 (개발자용)**

Apps Script 편집기에서:

1. 함수 선택: `testInquiry`
2. 실행 버튼 (▶) 클릭
3. 실행 로그 확인
4. Google Sheets 확인

---

## 🔄 Google Sheets 자동 계산 설정 (선택사항)

현재 앱은 수동으로 호수 범위를 입력하지만, 자동으로 계산하도록 설정할 수 있습니다:

### **호수 자동 할당 설정**

Google Sheets에서 K컬럼(호수)에 자동 공식 추가:

```
=ARRAYFORMULA(IF(ROW(A2:A)=1, "호수", IF(B2:B="", "", IF(M2:M="", "", TEXT(FLOOR(ROW(A2:A)/계약건수), "0")))))
```

---

## 📊 Google Sheets 컬럼 구조

| 컬럼 | 이름     | 설명                         |
| ---- | -------- | ---------------------------- |
| A    | 번호     | 문의 ID (자동 생성)          |
| B    | 날짜     | 접수 날짜                    |
| C    | 고객명   | 회사명                       |
| D    | 담당자   | 고객사 담당자명              |
| E    | 직책     | 직책                         |
| F    | 전화     | 전화번호                     |
| G    | 이메일   | 이메일                       |
| H    | 광고유형 | 전면/반면/사분면             |
| I    | 사이즈   | FC/1/2 Page                  |
| J    | 시작날짜 | 광고 시작 예정일             |
| K    | 호수     | 계약 호수 범위 (수동 입력)   |
| L    | 계약기간 | 계약 기간 (수동 입력)        |
| M    | 비고     | 상담 내역, 견적 정보 등      |
| N    | 팔로업   | 다음 연락 예정일 (수동 입력) |
| O    | 접수경로 | ONLINE/OFFLINE               |
| P    | 담당자   | 문의를 입력한 영업담당자     |
| Q    | 접수방법 | 전화/면담/이메일/기타        |

---

## 🐛 문제 해결

### **Q: 폼을 제출했는데 Google Sheets에 저장되지 않음**

✅ 확인 사항:

1. Google Apps Script URL을 정확히 복사했는가?
2. Apps Script가 '배포'되었는가? (저장만으로는 안 됨)
3. SHEET_ID를 정확히 입력했는가?
4. "광고접수인덱스" 시트 이름이 정확한가?

### **Q: "403 Forbidden" 오류**

✅ 해결:

1. Apps Script를 다시 배포
2. "액세스 권한" = "모든 사용자"로 설정
3. "실행 사용자" = "나" (본인)로 설정

### **Q: Google Sheets에 가끔만 저장됨**

✅ 가능성:

- 네트워크 오류 (자동 재시도됨)
- CORS 오류 - 해결 됨 (`mode: 'no-cors'` 사용)

설정을 다시 확인하고, 브라우저 콘솔(F12)에서 에러 메시지를 확인하세요

---

## 📱 모바일 최적화

두 폼 모두 모바일 반응형으로 설계되었습니다:

- 📞 휴대폰에서도 완벽하게 작동
- 터치 친화적 UI
- 자동 스케일 조정

---

## 🔐 보안

### **개인정보 보호**

- 폼 제출 시 자동으로 개인정보 수집 동의 확인
- Google Sheets는 자동으로 암호화됨
- Google 계정으로만 접근 가능

### **스팸 방지**

필요시 다음 추가 가능:

- reCAPTCHA v3 (봇 차단)
- Email 중복 확인
- 제출 간격 제한

---

## 📞 지원

문제가 발생하면:

1. 브라우저 콘솔 확인 (F12 > Console)
2. Google Sheets 접근 권한 확인
3. Apps Script 배포 상태 확인
4. 관리자에게 문의

---

**설정 완료 후:**
✅ 온라인 폼이 웹사이트에 표시됨
✅ 오프라인 폼이 담당자용으로 준비됨
✅ 모든 문의가 자동으로 LeadPipeline에 표시됨
✅ 영업 파이프라인 자동화 시작! 🚀
